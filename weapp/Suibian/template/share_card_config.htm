{include file="header.htm" /}
<body class="bodystyle" style="overflow: auto;min-width:auto;">
<div id="toolTipLayer" style="position: absolute; z-index: 9999; display: none; visibility: visible; left: 95px; top: 573px;"></div>
<div id="append_parent"></div>
<div id="ajaxwaitid"></div>
<div class="page min-hg-c-i" style="min-width: auto;box-shadow:none;padding-bottom: 0px;">
    <form class="form-horizontal" id="post_form">
        <input type="hidden" name="type" value="{$type}">
        <div class="ncap-form-default">
            <dl class="row">
                <dt class="tit"><label for="shareTitle"><em>*</em>分享标题</label></dt>
                <dd class="opt w0">
                    <input type="text" name="shareTitle" value="{$config.shareTitle}" id="shareTitle" class="input-txt" autocomplete="off">
                    <div style="clear: both;"></div>
                    <p class="notic2">{eq name="type" value="shopIndex"}网站简称变量{else/}用户昵称变量{/eq} {$config.shareTag}</p>
                    <!-- <a href="javascript:void(0);" onclick="inputShareTag('{$config.shareTag}');"></a> -->
                </dd>
            </dl>

            <dl class="row">
                <dt class="tit"><label for="sharePic">分享图片</label></dt>
                <dd class="opt w0">
                    <div class="dan-pane">
                        <div class="images_upload images_upload_html" style="display:inline-block;">
                            <a href="javascript:void(0);" onclick="GetUploadify(1, '', 'allimg', 'sharePicBack');" class="img-upload no-float" title="点击上传">
                                <div class="y-line" id="sharePicYLine" {notempty name="$config.sharePic"} style="display: none;" {/notempty}></div>
                                <div class="x-line" id="sharePicXLine" {notempty name="$config.sharePic"} style="display: none;" {/notempty}></div>
                                <img src="{$config.sharePic}" id="sharePicSrc" class="pic_con">
                            </a>
                            <a href="javascript:void(0);" onclick="sharePicClear();" class="delect" title="删除"></a>
                            <input type="hidden" id="sharePic" name="sharePic" value="{$config.sharePic}">
                        </div>
                    </div>
                    <div style="clear: both;"></div>
                    <p class="notic2">建议上传图片宽:高比例为5:4，不上传则使用页面截图</p>
                </dd>
            </dl>
        </div>
        <div class="ncap-form-default">
            <div class="bot">
                <a href="JavaScript:void(0);" onclick="submitConfig();" class="ncap-btn-big ncap-btn-green">确认提交</a>
            </div>
        </div>
    </form>
</div>
<script type="text/javascript">
    // 键入简称
    // function inputShareTag(value) {
    //     $('#shareTitle').eyouInsertAtFocus(value);
    // }
    // (function($) {
    //     $.fn.extend({
    //         eyouInsertAtFocus: function(value) {
    //             var $obj = $(this)[0];
    //             if (document.selection) {
    //                 this.focus();
    //                 sel = document.selection.createRange();
    //                 sel.text = value;
    //                 this.focus();
    //             } else if ($obj.selectionStart || $obj.selectionStart == '0') {
    //                 var startPos = $obj.selectionStart;
    //                 var endPos = $obj.selectionEnd;
    //                 var scrollTop = $obj.scrollTop;
    //                 $obj.value = $obj.value.substring(0, startPos) + value + $obj.value.substring(endPos, $obj.value.length);
    //                 this.focus();
    //                 $obj.selectionStart = startPos + value.length;
    //                 $obj.selectionEnd = startPos + value.length;
    //                 $obj.scrollTop = scrollTop;
    //             } else {
    //                 this.value += value;
    //                 this.focus();
    //             }
    //         }
    //     });
    // })(jQuery);

    // 加载新图片
    function sharePicBack(paths) {
        $('#sharePic').val(paths);
        $('#sharePicSrc').show().attr('src', paths);
        $('#sharePicYLine, #sharePicXLine').hide();
    }

    // 清除图片信息
    function sharePicClear() {
        $('#sharePic').val('');
        $('#sharePicSrc').hide().attr('src', '');
        $('#sharePicYLine, #sharePicXLine').show();
    }

    // 提交保存配置
    function submitConfig() {
        layer_loading('正在处理');
        $.ajax({
            type: 'post',
            url : "{:weapp_url('Suibian/Suibian/share_card_config', ['_ajax'=>1])}",
            data: $('#post_form').serialize(),
            dataType: 'json',
            success: function(res) {
                layer.closeAll();
                if (1 === parseInt(res.code)) {
                    showSuccessMsg(res.msg, 1000, function() {
                        parent.window.location.reload();
                    });
                } else {
                    showErrorMsg(res.msg);
                }
            },
            error: function(e) {
                layer.closeAll();
                showErrorAlert(e.responseText);
            }
        });
    }
</script>
{include file="footer.htm" /}